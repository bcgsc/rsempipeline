#!/bin/bash
#$ -S /bin/bash
#$ -q all.q
#$ -N {{sample.name}}
#$ -pe ncpus {{num_jobs}} {% set mem = 45 / num_jobs %}
#$ -l excl=true,mem_free={{mem|int}}G,mem_token={{mem|int}}G,h_vmem={{mem|int}}G
#$ -j y
#$ -V

cd ${SGE_O_WORKDIR}

python {{rsem_pipeline_py}} \
    --soft_file {{soft_file}} \
    --isamples "{{isamples_str}}" \
    --host_to_run local \
    --config_file {{config_file}} \
    --logging_config {{logging_config}} \
    --use_pickle \
    --top_outdir {{top_outdir}} \
    --jobs {{num_jobs}} \
    --use_threads \
    --recreate_database \
    -T sra2fastq -T rsem


echo returncode: $?

if [ -f lele ]; then
    echo 'alfred'
    find . -name '*.sra' -exec rm -v '{}' ';'
    find . -name '*.fastq.gz' -exec rm -v '{}' ';'
fi
